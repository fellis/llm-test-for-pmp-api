# ABLE Core: Диаграммы

## 1. Позиционирование на рынке

```
                         Human Confirmation Required
                                    ▲
                                    │
                    ┌───────────────┼───────────────┐
                    │               │               │
                    │   Wikibase    │  ★ ABLE Core  │
                    │               │               │
                    │   ADR Tools   │               │
                    │               │               │
   Static ◄─────────┼───────────────┼───────────────┼─────────► Dynamic
   Sources          │               │               │           Sources
                    │               │               │
                    │  metaphactory │   Graphiti    │
                    │               │   Zep         │
                    │  Data Catalogs│   Mem0        │
                    │               │               │
                    └───────────────┼───────────────┘
                                    │
                                    ▼
                         Auto-accept (LLM decides)


★ ABLE Core = единственная позиция:
  - Dynamic sources (код, чаты, документы меняются)
  - Human confirmation (LLM не authority)
```

---

## 2. Сравнение с существующими решениями

```
┌────────────────────┬──────────┬──────────┬──────────┬──────────┬────────────┐
│                    │ AI Memory│ Data     │ PKM      │ Ontology │ ABLE Core  │
│                    │ (Mem0)   │ Catalogs │ (Obsid.) │ (metaph.)│            │
├────────────────────┼──────────┼──────────┼──────────┼──────────┼────────────┤
│ Semantic search    │    ✓     │    ◐     │    ◐     │    ✗     │     ✓      │
│ Graph relations    │    ✓     │    ✓     │    ✓     │    ✓     │     ✓      │
│ Source tracking    │    ✗     │    ✓     │    ✗     │    ✓     │     ✓      │
│ Human confirmation │    ✗     │    ◐     │    ✗     │    ✓     │     ✓      │
│ Orphaning          │    ✗     │    ✗     │    ✗     │    ✗     │     ✓      │
│ IDE/Agent integr.  │    ✓     │    ✗     │    ✗     │    ✗     │     ✓      │
│ Lifecycle states   │    ✗     │    ◐     │    ✗     │    ✓     │     ✓      │
│ Code-aware         │    ✗     │    ✗     │    ✗     │    ✗     │     ✓      │
├────────────────────┼──────────┼──────────┼──────────┼──────────┼────────────┤
│ Цена               │  Free/$  │  $$$$$   │   Free   │  $$$$$   │    Free    │
└────────────────────┴──────────┴──────────┴──────────┴──────────┴────────────┘

✓ = есть    ◐ = частично    ✗ = нет
```

---

## 3. Архитектура ядра

```
╔═══════════════════════════════════════════════════════════════════════════╗
║                              ABLE CORE                                     ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                                                                           ║
║   ┌─────────────────────────────────────────────────────────────────┐    ║
║   │                      GRAPH LAYER                                 │    ║
║   │                                                                  │    ║
║   │    ┌──────────┐         ┌──────────┐         ┌──────────┐       │    ║
║   │    │ Entity A │────────▶│ Relation │◀────────│ Entity B │       │    ║
║   │    │ [Active] │         │          │         │[Orphaned]│       │    ║
║   │    └──────────┘         └──────────┘         └──────────┘       │    ║
║   │                                                                  │    ║
║   │    Подтверждённые сущности + связи + lifecycle                  │    ║
║   └─────────────────────────────────────────────────────────────────┘    ║
║                                   ▲                                       ║
║                                   │ confirm/reject                        ║
║   ┌─────────────────────────────────────────────────────────────────┐    ║
║   │                     VECTOR LAYER                                 │    ║
║   │                                                                  │    ║
║   │    ⚫──⚫──⚫──⚫   embeddings   ⚫──⚫──⚫──⚫                    │    ║
║   │                                                                  │    ║
║   │    Semantic similarity для recall гипотез                       │    ║
║   │    ⚠️  НЕ источник истины                                       │    ║
║   └─────────────────────────────────────────────────────────────────┘    ║
║                                   ▲                                       ║
║                                   │ embed                                 ║
║   ┌─────────────────────────────────────────────────────────────────┐    ║
║   │                     SEARCH LAYER                                 │    ║
║   │                                                                  │    ║
║   │    SELECT * FROM units WHERE ... ORDER BY ...                   │    ║
║   │                                                                  │    ║
║   │    Детерминированный поиск (snapshot → результат)               │    ║
║   └─────────────────────────────────────────────────────────────────┘    ║
║                                   ▲                                       ║
║                                   │ ingest                                ║
║   ┌─────────────────────────────────────────────────────────────────┐    ║
║   │                     SOURCE LAYER                                 │    ║
║   │                                                                  │    ║
║   │    ┌─────┐   ┌─────┐   ┌─────┐   ┌─────┐   ┌─────┐             │    ║
║   │    │ Git │   │Files│   │Chats│   │ Web │   │ API │             │    ║
║   │    └──┬──┘   └──┬──┘   └──┬──┘   └──┬──┘   └──┬──┘             │    ║
║   │       │         │         │         │         │                  │    ║
║   │       └─────────┴─────────┴─────────┴─────────┘                  │    ║
║   │                          │                                       │    ║
║   │              Knowledge Units + change events                     │    ║
║   └─────────────────────────────────────────────────────────────────┘    ║
║                                                                           ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                              CORE API                                      ║
║                                                                           ║
║    GET /knowledge/active     POST /propose    POST /confirm    ...        ║
╚═══════════════════════════════════════════════════════════════════════════╝
                                    │
            ┌───────────────────────┼───────────────────────┐
            │                       │                       │
            ▼                       ▼                       ▼
     ┌────────────┐         ┌────────────┐         ┌────────────┐
     │   Cursor   │         │  moltbot   │         │   Other    │
     │    MCP     │         │            │         │  Clients   │
     └────────────┘         └────────────┘         └────────────┘
```

---

## 4. Lifecycle знаний

```
                              ┌─────────────────┐
                              │                 │
                              │   HYPOTHESIS    │◀─── LLM предложил
                              │                 │     система обнаружила
                              └────────┬────────┘
                                       │
                                       │ show to user
                                       ▼
                              ┌─────────────────┐
                              │                 │
                              │    PROPOSED     │◀─── ждёт решения
                              │                 │
                              └────────┬────────┘
                                       │
                    ┌──────────────────┴──────────────────┐
                    │                                      │
                    │ confirm                              │ reject
                    ▼                                      ▼
           ┌─────────────────┐                    ┌─────────────────┐
           │                 │                    │                 │
           │   CONFIRMED     │                    │    REJECTED     │
           │                 │                    │                 │
           └────────┬────────┘                    └─────────────────┘
                    │
                    │ activate
                    ▼
           ┌─────────────────┐
           │                 │
           │     ACTIVE      │◀─── используется клиентами
           │                 │
           └────────┬────────┘
                    │
                    │ source changed/deleted
                    ▼
           ┌─────────────────┐
           │                 │
           │    ORPHANED     │◀─── источник невалиден
           │                 │
           └────────┬────────┘
                    │
       ┌────────────┴────────────┐
       │                         │
       │ re-confirm              │ deprecate
       ▼                         ▼
┌─────────────────┐     ┌─────────────────┐
│                 │     │                 │
│     ACTIVE      │     │   DEPRECATED    │
│                 │     │                 │
└─────────────────┘     └─────────────────┘
```

---

## 5. Cursor Integration (MVP)

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                           USER WORKFLOW                                 │
│                                                                         │
│   ┌─────────┐                                                          │
│   │  User   │                                                          │
│   └────┬────┘                                                          │
│        │                                                                │
│        │ writes prompt                                                  │
│        ▼                                                                │
│   ╔═══════════════════════════════════════════════════════════════╗    │
│   ║                    HOOK: PRE-PROMPT                           ║    │
│   ╠═══════════════════════════════════════════════════════════════╣    │
│   ║                                                               ║    │
│   ║   Cursor ───GET /knowledge/active───▶ ABLE Core              ║    │
│   ║                                                               ║    │
│   ║   ABLE Core ───[Entity, Entity, ...]───▶ Cursor              ║    │
│   ║                                                               ║    │
│   ║   Cursor injects into LLM context                            ║    │
│   ║                                                               ║    │
│   ╚═══════════════════════════════════════════════════════════════╝    │
│        │                                                                │
│        │ LLM generates (with knowledge context)                        │
│        ▼                                                                │
│   ┌─────────────────────────────────────────────────────────────┐      │
│   │                                                             │      │
│   │                    User edits code                          │      │
│   │                                                             │      │
│   └─────────────────────────────────────────────────────────────┘      │
│        │                                                                │
│        │ git add / prepare commit                                       │
│        ▼                                                                │
│   ╔═══════════════════════════════════════════════════════════════╗    │
│   ║                    HOOK: PRE-COMMIT                           ║    │
│   ╠═══════════════════════════════════════════════════════════════╣    │
│   ║                                                               ║    │
│   ║   Cursor ───POST /knowledge/propose───▶ ABLE Core            ║    │
│   ║            { diff, context }                                  ║    │
│   ║                                                               ║    │
│   ║   ABLE Core ───[Hypothesis, ...]───▶ Cursor                  ║    │
│   ║               "Зафиксировать решение X?"                      ║    │
│   ║                                                               ║    │
│   ║   User ───confirm/reject───▶ Cursor ───▶ ABLE Core           ║    │
│   ║                                                               ║    │
│   ╚═══════════════════════════════════════════════════════════════╝    │
│        │                                                                │
│        │                                                                │
│        ▼                                                                │
│   ┌─────────────────────────────────────────────────────────────┐      │
│   │                       git commit                            │      │
│   └─────────────────────────────────────────────────────────────┘      │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 6. Orphaning: как это работает

```
                    TIME
    ────────────────────────────────────────────────▶

    T1: Код существует
    ┌──────────────────────────────────────────────┐
    │  source: auth.ts (revision: abc123)          │
    │  knowledge: "Auth uses JWT tokens"           │
    │  status: ACTIVE                              │
    │  anchor: (auth.ts, abc123, unit_42)          │
    └──────────────────────────────────────────────┘
                        │
                        │ T2: Файл изменён (revision: def456)
                        ▼
    ┌──────────────────────────────────────────────┐
    │  Source Layer detects change                 │
    │                                              │
    │  emit: { type: UPDATED,                      │
    │          source_id: auth.ts,                 │
    │          old_revision: abc123,               │
    │          new_revision: def456 }              │
    └──────────────────────────────────────────────┘
                        │
                        │ T3: Graph Layer processes
                        ▼
    ┌──────────────────────────────────────────────┐
    │  Find all knowledge with anchor.source_id   │
    │  = auth.ts AND anchor.revision = abc123     │
    │                                              │
    │  For each: status → ORPHANED                │
    │            reason: "source_updated"          │
    └──────────────────────────────────────────────┘
                        │
                        │ T4: User sees in Cursor
                        ▼
    ┌──────────────────────────────────────────────┐
    │  "Knowledge 'Auth uses JWT' is orphaned.    │
    │   Source file changed. Re-confirm?"          │
    │                                              │
    │   [Re-confirm] [Deprecate] [View diff]       │
    └──────────────────────────────────────────────┘
                        │
            ┌───────────┴───────────┐
            ▼                       ▼
    ┌───────────────┐      ┌───────────────┐
    │ Re-confirm    │      │ Deprecate     │
    │               │      │               │
    │ status:ACTIVE │      │ status:DEPRECATED│
    │ anchor:       │      │               │
    │  (auth.ts,    │      └───────────────┘
    │   def456,     │
    │   unit_42)    │
    └───────────────┘
```

---

## 7. Масштабирование

```
                            MVP                         FUTURE
                             │                            │
                             ▼                            ▼
    ┌────────────────────────────────────────────────────────────────────┐
    │                        SOURCE LAYER                                │
    │                                                                    │
    │    MVP:                           FUTURE:                          │
    │    ┌─────┐ ┌─────┐               ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐  │
    │    │ Git │ │Files│               │Chats│ │ Web │ │Trans│ │ API │  │
    │    └─────┘ └─────┘               └─────┘ └─────┘ └─────┘ └─────┘  │
    │                                                                    │
    └────────────────────────────────────────────────────────────────────┘

    ┌────────────────────────────────────────────────────────────────────┐
    │                        GRAPH LAYER                                 │
    │                                                                    │
    │    MVP:                           FUTURE:                          │
    │    - ArchitectureDecision         - Person                         │
    │    - Single user                  - Project                        │
    │                                   - Meeting                        │
    │                                   - Multi-user + roles             │
    │                                   - Voting / quorum                │
    │                                                                    │
    └────────────────────────────────────────────────────────────────────┘

    ┌────────────────────────────────────────────────────────────────────┐
    │                         CLIENTS                                    │
    │                                                                    │
    │    MVP:                           FUTURE:                          │
    │    ┌────────┐                     ┌────────┐ ┌────────┐ ┌────────┐│
    │    │ Cursor │                     │moltbot │ │  CLI   │ │  Web   ││
    │    │  MCP   │                     │        │ │        │ │   UI   ││
    │    └────────┘                     └────────┘ └────────┘ └────────┘│
    │                                                                    │
    └────────────────────────────────────────────────────────────────────┘
```
